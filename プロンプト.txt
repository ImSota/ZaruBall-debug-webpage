要件定義
自作キーボードZaruBallの組み立て時に起きた不具合の症状を元にどのパーツに問題があるかを表示するwebサイトをgithub pageを使用して作成する。まずは要件定義書をrequirements.mdとして作成。

キーボードの配列をファームウェアの設定ファイルを元に画面上に再現し、不具合のあるキーを複数選択。決定ボタンを押すことで不具合のあるパーツ(ダイオード、スイッチソケット、マイコンのGPIOピン)を推測してくれる。

zmk-config-ZaruBallフォルダの中はZaruBall用のファームウェアの設定ファイルが含まれている。これらの情報をもとに、画面上にキーボードの配列を再現すること。

ZaruBall.dtsi/ZaruBall_left.overlay/ZaruBall_right.overlayのように.dtsiや.oerlayという拡張子で終わるファイルには物理的なキーボードの設定項目が記述されている。.dtsiファイルにはすべてのキーボード(左右分割の場合、両手分)に共通する設定が格納されており、.overlayでそれぞれのキーボード固有の設定が格納されている。

・kscan0ノード：キースイッチのマトリクスに割り当てているマイコン(xiao ble)のピン番号を決定。
compatibleではkscan-gpio-matrixが通常マトリクス、kscan-gpio-charlieplexがchrlieplexでマトリクスが構成されている事を意味する。diode-directionでは行からの信号を列で受け取るのか、列からの信号を行で受け取るのかを決定する。　

・default_transformノード：スイッチがどのマイコンのピンと接続されているかを定義。RC(1,2)はkscan0にてrow-gpiosで2番目に設定されたgpioとcolumn-gpiosの3番目に設定されたgpioに接続されていることが分かる。col-offsetやrow-offsetでは分割キーボードにおいて、それぞれ別々.overlayファイルにてcol-gpiosを設定した時に参照する行列番号が左右キーボードで一致しないようにするためのオフセット数を定める。

・physical_layout0ノード：各スイッチの物理的な配置を決定。順番は、default_transformノードのスイッチの順番と合致している。 <&key_physical_attrs 100 100  982  480  (-1500)  982   480>はこのキーが幅1u、高さ1u、左上を原点とした時のxy座標が(9.82u, 4.80u)、回転角度が-15度、回転の中心となる座標が(9.82u, 4.80u)であることを示している。


追加指示
ファームウェアのフォルダを選択し、そのフォルダ内を解析して配列を再現したり不具合箇所を推測する。これによって他のキーボードでも同じような不具合を防ぐことができるようにしたい。
――――――――――――――――――――――――――――――――――――
chosenノードがあるとき、そこにphysical-layoutが定義されていることがある。この時は定義されたノードをphysical layoutとして使用すること。
/ {
    chosen {
        zmk,physical-layout = &lalapad_physical_layout;
    };